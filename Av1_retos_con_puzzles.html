<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Reto Valencia be Guides</title>
<style>
Â body {
Â  font-family: "Book Antiqua", Palatino, serif;
Â  margin: 1em; /* Mantenemos margen relativo */
Â  background: #fff;
Â  color: #222;
Â  font-size: 16px; /* Asegura un tamaÃ±o base para 'em' */
}
Â  h2 { /* Este es el tÃ­tulo visible en la pÃ¡gina */
Â  Â  margin-bottom: 0.8em;
Â  }
Â  h3 {
Â  Â  margin-bottom: 0.2em;
Â  }
Â  #reto {
Â  Â  border: 3px solid #ccc;
Â  Â  border-radius: 8px;
Â  Â  padding: 1em;
Â  Â  margin-bottom: 1em;
Â  Â  position: relative;
Â  Â  min-height: 220px;
Â  }
Â  .respuesta {
Â  Â  margin: 0.4em 0;
Â  Â  font-size: 1.1em;
Â  Â  display: flex;
Â  Â  align-items: center;
Â  }
Â  .respuesta input[type="radio"] {
Â  Â  margin-right: 0.7em;
Â  Â  transform: scale(1.3);
Â  Â  cursor: pointer;
Â  }
Â  .respuesta input[type="checkbox"] {
Â  Â  margin-right: 0.7em;
Â  Â  transform: scale(1.3);
Â  Â  cursor: pointer;
Â  }
Â  .respuesta input[type="text"] {
Â  Â  flex-grow: 1;
Â  Â  font-size: 1.1em;
Â  Â  padding: 0.3em 0.5em;
Â  Â  border-radius: 4px;
Â  Â  border: 1px solid #999;
Â  }
Â  /* Contenedor para los botones para que estÃ©n en la misma lÃ­nea */
Â  #button-container {
Â  Â  display: flex;
Â  Â  flex-wrap: wrap; /* Permite que los botones salten de lÃ­nea si no hay espacio */
Â  Â  gap: 1em; /* Espacio entre los botones */
Â  Â  margin-top: 1em;
Â  Â  justify-content: center; /* Centra los botones horizontalmente */
Â  Â  align-items: center; /* Alinea verticalmente los botones si tienen alturas diferentes */
Â  }

Â  button.btn, button#btnMostrarRespuesta, button#btnNextAfterReto {
Â  Â  padding: 0.6em 1.2em;
Â  Â  font-size: 1.1em;
Â  Â  border: none;
Â  Â  border-radius: 6px;
Â  Â  cursor: pointer;
Â  Â  background-color: #0077cc;
Â  Â  color: white;
Â  Â  user-select: none;
Â  }
Â  button.btn:disabled {
Â  Â  background-color: #999;
Â  Â  cursor: not-allowed;
Â  }
Â  #btnMostrarRespuesta, #btnNextAfterReto {
Â  Â  display: none; /* Por defecto ocultos, su visibilidad se controla con JS */
Â  Â  background-color: #28a745;
Â  }
Â  #respuestaCorrectaTexto {
Â  Â  margin-top: 1em;
Â  Â  font-weight: bold;
Â  Â  /* Centrar el texto de la respuesta */
Â  Â  text-align: center; 
Â  Â  position: absolute; /* Para que se superponga al iframe */
Â  Â  top: 50%; /* Centrado verticalmente */
Â  Â  left: 50%; /* Centrado horizontalmente */
Â  Â  transform: translate(-50%, -50%); /* Ajuste fino para centrar */
Â  Â  width: 80%; /* Para que ocupe un ancho razonable */
Â  Â  background-color: rgba(255, 255, 255, 0.9); /* Fondo semitransparente para que se lea bien */
Â  Â  padding: 1em;
Â  Â  border-radius: 8px;
Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
Â  Â  font-size: 1.5em; /* TamaÃ±o mÃ¡s grande para visibilidad */
Â  Â  color: #222; /* Color de texto que contraste */
Â  Â  z-index: 20; /* Asegura que estÃ© por encima del iframe */
Â  Â  display: none; /* Inicialmente oculto */
Â  }
Â  #fuegos {
Â  Â  pointer-events: none;
Â  Â  position: absolute;
Â  Â  top: 0; left: 0; /* Cubrir toda la ventana */
Â  Â  width: 100%;
Â  Â  height: 100%;
Â  Â  z-index: 10;
Â  Â  overflow: hidden; /* Evitar que las chispas se salgan */
Â  Â  display: none; /* Inicialmente oculto */
Â  }

Â  /* Border colors for correct/incorrect */
Â  #reto.correct {
Â  Â  border-color: #28a745; /* Verde */
Â  }
Â  #reto.incorrect {
Â  Â  border-color: #c00; /* Rojo */
Â  }

Â  /* Media Query para mÃ³viles en horizontal: oculta el h2 y ajusta el espacio */
Â  @media (max-width: 800px) and (orientation: landscape) {
Â  Â  h2 {
Â  Â  Â  display: none; /* Oculta el tÃ­tulo "Reto Valencia be Guides" */
Â  Â  }
Â  Â  body {
Â  Â  Â  margin: 0.5em; /* Reduce los mÃ¡rgenes del body para ganar espacio */
Â  Â  }
Â  Â  #reto {
Â  Â  Â  min-height: 180px; /* Ajusta la altura mÃ­nima del reto */
Â  Â  Â  padding: 0.8em; /* Reduce el padding del reto */
Â  Â  }
Â  Â /* Botones de enviar, siguiente, mostrar respuesta */
#btnEnviar, #btnNext, #btnMostrarRespuesta {
Â  padding: 0.8em 1.5em; /* Padding relativo */
Â  font-size: 1em; /* TamaÃ±o de fuente relativo al body */
Â  border: 2px solid #007bff;
Â  border-radius: 5px;
Â  background-color: #007bff;
Â  color: white;
Â  cursor: pointer;
Â  margin-top: 1em; /* Margen relativo */
Â  transition: background-color 0.3s ease;
Â  display: inline-block; /* Asegura que los botones se comporten bien en lÃ­nea */
Â  text-align: center; /* Centra el texto en botones */
}
#btnMostrarRespuesta {
Â  background-color: #f0ad4e;
Â  border-color: #f0ad4e;
}
#btnMostrarRespuesta:hover {
Â  background-color: #ec971f;
Â  border-color: #ec971f;
}

Â  /* Estilos especÃ­ficos para el iframe del puzzle */
Â  #puzzleIframe {
Â  Â  width: 100%;
Â  Â  height: calc(100vh - 150px); /* Ajusta la altura para que ocupe mÃ¡s espacio */
Â  Â  border: 1px solid #ddd;
Â  Â  border-radius: 8px;
Â  Â  display: block; /* Para asegurarse de que ocupe el ancho completo */
Â  Â  margin: 1em auto;
Â  }
}

/* Media Query para pantallas mÃ¡s grandes o portrait */
@media (min-width: 801px) or (orientation: portrait) {
    #puzzleIframe {
        width: 100%;
        max-width: 800px; /* Limita el ancho en pantallas grandes */
        height: 600px; /* Altura fija para pantallas mÃ¡s grandes */
        display: block;
        margin: 1em auto;
    }
}
</style>
</head>
<body>

<h2>Aventura 1 Retos</h2>
<div id="reto" tabindex="0"></div>

<div id="button-container">
Â  <button id="btnMostrarRespuesta">Respuesta Correcta</button>
Â  <button id="btnNextAfterReto">Siguiente</button>
</div>
<div id="respuestaCorrectaTexto"></div>


<div id="fuegos"></div> 

<script>
/* --- Datos retos --- */
const retos = [
Â {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "1. Â¿CuÃ¡ntas Aventuras pueden hacerse con Valencia be Guides?",
Â  Â  opciones: ["4", "5", "6", "7"],
Â  Â  correctas: ["7"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "2. Â¿SabrÃ­a decirme cÃ³mo se llaman estas Torres?",
Â  Â  opciones: ["Torres de Quart", "Torres de Serranos", "Torre del Miguelete", "Torre de Santa catalina"],
Â  Â  correctas: ["Torres de Serranos"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "3. Â¿En la cumbre de las torres ondea la bandera de Valencia: sus colores se componen de rojo, amarillo yâ€¦ ?",
Â  Â  opciones: ["Violeta", "Verde", "Azul"],
Â  Â  correctas: ["Azul"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "texto",
Â  Â  pregunta: "4. Â¿SabrÃ­a decirme el nombre de la calle?",
Â  Â  correctaTexto: "Calle Muro de Santa Ana"
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "5. Â¿QuÃ© porta San Lorenzo en la mano?",
Â  Â  opciones: ["Una Paloma", "Una cuchara", "Una parrilla"],
Â  Â  correctas: ["Una parrilla"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "6. Â¿Con quÃ© mano sujeta Neptuno la cornucopia?",
Â  Â  opciones: ["Izquierda", "Derecha"],
Â  Â  correctas: ["Derecha"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "texto",
Â  Â  pregunta: "7. Â¿CuÃ¡ntas figuras rodean la fuente?",
Â  Â  correctaTexto: "8"
Â  },
Â  {
Â  Â  tipo: "puzzle",
Â  Â  pregunta: "8. Plaza de la Virgen",
Â  Â  puzzleSrc: "P8_puzzle_plaza_virgen.html"
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "9. Â¿QuÃ© figura esculpida puede verse en el marco del cuadro?",
Â  Â  opciones: ["Un DragÃ³n", "Un MurciÃ©lago", "Una Corona"],
Â  Â  correctas: ["Una Corona"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "opcion-multiple",
Â  Â  pregunta: "10. Â¿QuÃ© puede verse dentro?",
Â  Â  opciones: ["Un Altar", "Una bandera", "Una espada"],
Â  Â  correctas: ["Un Altar", "Una bandera"],
Â  Â  multiple: true
Â  },
Â  {
Â  Â  tipo: "texto",
Â  Â  pregunta: "11. Sobre Ã©sta hay una placa conmemorativa. Â¿En quÃ© aÃ±o fue expuesta dicha placa?",
Â  Â  correctaTexto: "1952"
Â  },
Â  {
Â  Â  tipo: "texto",
Â  Â  pregunta: "12. Â¿En quÃ© aÃ±o se edificÃ³ esta finca? Â¡Pista! Mire en la parte superior de la fachada.",
Â  Â  correctaTexto: "1906"
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "13. Â¿QuÃ© puede verse dentro?",
Â  Â  opciones: ["Una Plaza de Toros", "Unos baÃ±os romanos", "Una estaciÃ³n de metro"],
Â  Â  correctas: ["Unos baÃ±os romanos"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "14. Â¿SabrÃ­a determinar quÃ© geometrÃ­a tiene?",
Â  Â  opciones: ["hexagonal", "Octogonal", "Cuadrangular"],
Â  Â  correctas: ["hexagonal"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "texto",
Â  Â  pregunta: "15. Â¿CuÃ¡ntos Arcos componen la puerta?",
Â  Â  correctaTexto: "6"
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "16. Â¿Recuerda quÃ© animal corona el escudo municipal?",
Â  Â  opciones: ["Un DragÃ³n", "Un MurciÃ©lago", "Un Caballo"],
Â  Â  correctas: ["Un MurciÃ©lago"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "17. Â¡Preste atenciÃ³n a la fachada de la primera torre! Â¿QuÃ© Fruta CÃ­trica natural de Valencia decora la fachada?",
Â  Â  opciones: ["Limones", "Pomelos", "Naranjas"],
Â  Â  correctas: ["Naranjas"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "puzzle",
Â  Â  pregunta: "18. Plaza de Toros y EstaciÃ³n del Norte",
Â  Â  puzzleSrc: "P18_puzzle_plaza_de_Toros_y_estacion_norte.html"
Â  },
Â  {
Â  Â  tipo: "texto",
Â  Â  pregunta: "19. Â¿SabrÃ­a decirme quÃ© comercio alberga dicho edificio?",
Â  Â  correctaTexto: "?"
Â  },
Â  {
Â  Â  tipo: "opcion-multiple",
Â  Â  pregunta: "20. Sobre la entrada principal, en un arco de medio punto, figuras alegÃ³ricas representan a los cinco continentes. Â¿QuÃ© porta la figura central?",
Â  Â  opciones: ["Una Corona", "Una Espada", "Una Antorcha"],
Â  Â  correctas: ["Una Corona", "Una Espada"],
Â  Â  multiple: true
Â  },
Â  {
Â  Â  Â tipo: "opcion",
Â  Â  pregunta: "21. Â¿QuÃ© porta la figura en la mano?",
Â  Â  opciones: ["Una balanza", "Un libro", "Una pluma"],
Â  Â  correctas: ["Una balanza"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "texto",
Â  Â  pregunta: "22. Â¿Cuantas plantas tiene el edificio?",
Â  Â  correctaTexto: "10"
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "23. Busque la vidriera con los colores de la SeÃ±era valenciana en la fachada del edificio. Â¿SabrÃ­a determinar quÃ© forma tiene?",
Â  Â  opciones: ["Cuadrangular", "Redonda", "Triangular"],
Â  Â  correctas: ["Redonda"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "opcion-multiple",
Â  Â  pregunta: "24. Â¿QuÃ© sostiene la virgen en su mano?",
Â  Â  opciones: ["Un Rosario", "Un niÃ±o", "Una corona"],
Â  Â  correctas: ["Un Rosario", "Un niÃ±o"],
Â  Â  multiple: true
Â  },
Â  {
Â  Â  tipo: "opcion",
Â  Â  pregunta: "25. Â¿QuÃ© le entrega el Ã¡ngel al niÃ±o?",
Â  Â  opciones: ["Una paloma", "Un orbe", "Alimentos"],
Â  Â  correctas: ["Un orbe"],
Â  Â  multiple: false
Â  },
Â  {
Â  Â  tipo: "puzzle",
Â  Â  pregunta: "26. Lonja de la Seda",
Â  Â  puzzleSrc: "P26_puzzle_lonja.html"
Â  },
Â  {
Â  Â  tipo: "opcion-multiple",
Â  Â  pregunta: "27. El barquero que rema a contracorriente.",
Â  Â  opciones: ["Un hombre con rostro triste manejando un pequeÃ±o bote de madera escapa a contracorriente de un monstruo."],
Â  Â  correctas: ["Un hombre con rostro triste manejando un pequeÃ±o bote de madera escapa a contracorriente de un monstruo."],
Â  Â  multiple: true
Â  },
Â  {
Â  Â  tipo: "opcion-multiple",
Â  Â  pregunta: "28. Un Ã¡rbol muerto: sÃ­mbolo del Pecado, se ve entre las dos hojas de la puerta y cumple la funciÃ³n de parteluz.",
Â  Â  opciones: ["Observe en la copa del Ã¡rbol como 4 hombres desnudos se azotan entre si."],
Â  Â  correctas: ["Observe en la copa del Ã¡rbol como 4 hombres desnudos se azotan entre si."],
Â  Â  multiple: true
Â  },
Â  {
Â  Â  tipo: "opcion-multiple",
Â  Â  pregunta: "29. A la derecha, un Ã¡ngel que muestra su pene y...",
Â  Â  opciones: ["se dispone a introducirlo en un jarrÃ³n que sostiene con la otra mano. Algo extraÃ±o e inusual Â¿no le parece?"],
Â  Â  correctas: ["se dispone a introducirlo en un jarrÃ³n que sostiene con la otra mano. Algo extraÃ±o e inusual Â¿no le parece?"],
Â  Â  multiple: true
Â  },
Â  {
Â  Â  tipo: "opcion-multiple",
Â  Â  pregunta: "30. En el centro El barbudo y el leÃ³n:",
Â  Â  opciones: ["Original y contradictoria escena en la cual el manso es precisamente el leÃ³n y no el anciano barbudo."],
Â  Â  correctas: ["Original y contradictoria escena en la cual el manso es precisamente el leÃ³n y no el anciano barbudo."],
Â  Â  multiple: true
Â  },
Â  {
Â  Â  tipo: "opcion-multiple",
Â  Â  pregunta: "31. Â¡AquÃ­ va un reto extra! Â¡Busque al fornicador de la lonja!",
Â  Â  opciones: ["En una de sus ventanas, hallarÃ¡ a un hombre tallado, no se le advierte su cabeza, pero sÃ­ sus genitales, Y muy claramente."],
Â  Â  correctas: ["En una de sus ventanas, hallarÃ¡ a un hombre tallado, no se le advierte su cabeza, pero sÃ­ sus genitales, Y muy claramente."],
Â  Â  multiple: true
Â  },
Â  {
Â  Â tipo: "opcion",
Â  Â  pregunta: "32. Â¿QuÃ© sostiene el niÃ±o en sus manos?",
Â  Â  opciones: ["Una paloma", "Una Concha", "Alimentos"],
Â  Â  correctas: ["Una Concha"],
Â  Â  multiple: false

Â  }
];

/* Variables para control */
let indiceReto = 0;
const retoDiv = document.getElementById("reto");
const btnEnviar = document.createElement("button");
btnEnviar.textContent = "Enviar";
btnEnviar.className = "btn";

const btnMostrarRespuesta = document.getElementById("btnMostrarRespuesta");
const divRespuestaCorrecta = document.getElementById("respuestaCorrectaTexto");
const btnNext = document.getElementById("btnNextAfterReto"); 
const fuegosDiv = document.getElementById("fuegos");

// DuraciÃ³n de la animaciÃ³n de fuegos artificiales (solo para retos de opciÃ³n/texto)
const DURACION_TOTAL_MS = 3000; 

/* FunciÃ³n para limpiar el reto y mostrar uno nuevo */
function mostrarReto() {
Â  // Limpiamos y ocultamos elementos visuales
Â  btnNext.style.display = "none"; 
Â  btnMostrarRespuesta.style.display = "none"; 
Â  divRespuestaCorrecta.style.display = "none"; // Ocultar el mensaje de respuesta
Â  divRespuestaCorrecta.textContent = ""; 
Â  retoDiv.classList.remove("correct", "incorrect"); 
Â  fuegosDiv.innerHTML = "";
Â  fuegosDiv.style.display = "none"; // Asegura que los fuegos de la pÃ¡gina principal estÃ©n ocultos

Â  btnNext.textContent = "Siguiente"; 

Â  const reto = retos[indiceReto];
Â  retoDiv.innerHTML = "";
Â  retoDiv.setAttribute("tabindex", "0"); 

Â  let preguntaElem = document.createElement("h3");
Â  preguntaElem.textContent = `${reto.pregunta}`; 
Â  retoDiv.appendChild(preguntaElem);

Â  if (reto.tipo === "opcion" || reto.tipo === "opcion-multiple") {
Â  Â  const inputType = reto.multiple ? "checkbox" : "radio";
Â  Â  reto.opciones.forEach((opcion, i) => {
Â  Â  Â  const divOpcion = document.createElement("div");
Â  Â  Â  divOpcion.className = "respuesta";
Â  Â  Â  const input = document.createElement("input");
Â  Â  Â  input.type = inputType;
Â  Â  Â  input.name = "op";
Â  Â  Â  input.value = opcion;
Â  Â  Â  input.id = "opcion" + i;
Â  Â  Â  divOpcion.appendChild(input);

Â  Â  Â  const label = document.createElement("label");
Â  Â  Â  label.htmlFor = input.id;
Â  Â  Â  label.textContent = opcion;
Â  Â  Â  divOpcion.appendChild(label);
Â  Â  Â  retoDiv.appendChild(divOpcion);
Â  Â  });
Â  Â  retoDiv.appendChild(btnEnviar);
Â  Â  btnEnviar.style.display = "inline-block"; 
Â  Â  btnEnviar.disabled = false;
Â  } else if (reto.tipo === "texto") {
Â  Â  const inputTexto = document.createElement("input");
Â  Â  inputTexto.type = "text";
Â  Â  inputTexto.id = "respuestaTexto";
Â  Â  inputTexto.autocomplete = "off";
Â  Â  inputTexto.spellcheck = false;
Â  Â  inputTexto.setAttribute("inputmode", "text");
Â  Â  inputTexto.style.fontSize = "1.2em";
Â  Â  inputTexto.style.width = "100%";
Â  Â  inputTexto.placeholder = "Escriba su respuesta aquÃ­...";
Â  Â  retoDiv.appendChild(inputTexto);
Â  Â  retoDiv.appendChild(btnEnviar);
Â  Â  btnEnviar.style.display = "inline-block"; 
Â  Â  btnEnviar.disabled = false;
Â  Â  setTimeout(() => inputTexto.focus(), 200);
Â  } else if (reto.tipo === "puzzle") {
Â  Â  const puzzleIframe = document.createElement("iframe");
Â  Â  puzzleIframe.id = "puzzleIframe";
Â  Â  puzzleIframe.src = reto.puzzleSrc;Â 
Â  Â  puzzleIframe.frameBorder = "0";
Â  Â  puzzleIframe.allowFullscreen = true;Â 
Â  Â  retoDiv.appendChild(puzzleIframe);
Â  Â Â 
Â  Â  // Ocultamos btnEnviar y btnMostrarRespuesta para los puzzles
Â  Â  btnEnviar.style.display = "none";
Â  Â  btnMostrarRespuesta.style.display = "none"; 
Â  }
}

/* AnimaciÃ³n de fuegos artificiales valencianos (Solo para retos de opciÃ³n/texto, NO para puzzles) */
function fuegosArtificiales() {
Â  const NUM_CHISPAS_POR_FUEGO = 30;
Â  const NUM_EXPLOSIONES = 15;

Â  fuegosDiv.innerHTML = "";
Â  fuegosDiv.style.display = "block"; // Mostrar el contenedor de fuegos

Â  for (let e = 0; e < NUM_EXPLOSIONES; e++) {
Â  Â  const delayExplosion = (DURACION_TOTAL_MS / NUM_EXPLOSIONES) * e;

Â  Â  setTimeout(() => {
Â  Â  Â  const startX = Math.random() * fuegosDiv.offsetWidth; /* Usar el ancho del div */
Â  Â  Â  const startY = Math.random() * fuegosDiv.offsetHeight; /* Usar el alto del div */

Â  Â  Â  for (let i = 0; i < NUM_CHISPAS_POR_FUEGO; i++) { 
Â  Â  Â  Â  let chispa = document.createElement("div");
Â  Â  Â  Â  chispa.style.position = "absolute";
Â  Â  Â  Â  chispa.style.borderRadius = "50%";
Â  Â  Â  Â  chispa.style.width = "12px";
Â  Â  Â  Â  chispa.style.height = "12px";
Â  Â  Â  Â  chispa.style.background = `hsl(${Math.random() * 360}, 100%, 70%)`;
Â  Â  Â  Â  chispa.style.opacity = "1";
Â  Â  Â  Â  chispa.style.left = `${startX}px`;
Â  Â  Â  Â  chispa.style.top = `${startY}px`;
Â  Â  Â  Â  chispa.style.zIndex = "10";

Â  Â  Â  Â  fuegosDiv.appendChild(chispa);

Â  Â  Â  Â  const angle = Math.random() * Math.PI * 2;
Â  Â  Â  Â  const distance = Math.random() * 80 + 40;
Â  Â  Â  Â  const endX = startX + distance * Math.cos(angle);
Â  Â  Â  Â  const endY = startY + distance * Math.sin(angle);

Â  Â  Â  Â  const chispaDuration = DURACION_TOTAL_MS / NUM_EXPLOSIONES * 1.5;

Â  Â  Â  Â  chispa.style.transition = `all ${chispaDuration}ms ease-out`;
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  chispa.style.left = `${endX}px`;
Â  Â  Â  Â  Â  chispa.style.top = `${endY}px`;
Â  Â  Â  Â  Â  chispa.style.opacity = "0";
Â  Â  Â  Â  Â  chispa.style.transform = "scale(0.5)";
Â  Â  Â  Â  }, 10);

Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  if (chispa.parentNode) {
Â  Â  Â  Â  Â  Â  chispa.parentNode.removeChild(chispa);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, delayExplosion + chispaDuration + 50);
Â  Â  Â  }
Â  Â  }, delayExplosion);
Â  }
Â  // Ocultar el contenedor de fuegos despuÃ©s de que terminen las animaciones
Â  setTimeout(() => {
Â  Â  fuegosDiv.style.display = "none";
Â  }, DURACION_TOTAL_MS + 100);
}


/* FunciÃ³n para vibrar */
function vibrar() {
Â  if (navigator.vibrate) navigator.vibrate(300);
}

/* FunciÃ³n para verificar la respuesta (para retos de opciÃ³n/texto) */
function verificar() {
Â  const reto = retos[indiceReto];
Â  btnEnviar.disabled = true;
Â  divRespuestaCorrecta.style.display = "none"; // Ocultar antes de mostrar nuevo mensaje
Â  divRespuestaCorrecta.textContent = "";
Â  retoDiv.classList.remove("correct", "incorrect");
Â  fuegosDiv.innerHTML = "";
Â  fuegosDiv.style.display = "none";

Â  btnNext.style.display = "none"; 
Â  btnNext.textContent = "Siguiente"; 

Â  let esCorrecto = false;

Â  if (reto.tipo === "opcion") {
Â  Â  const seleccion = document.querySelector('input[name="op"]:checked');
Â  Â  if (!seleccion) {
Â  Â  Â  alert("Por favor, seleccione una opciÃ³n.");
Â  Â  Â  btnEnviar.disabled = false;
Â  Â  Â  return;
Â  Â  }
Â  Â  esCorrecto = reto.correctas.includes(seleccion.value);
Â  } else if (reto.tipo === "opcion-multiple") {
Â  Â  const checks = Array.from(document.querySelectorAll('input[name="op"]:checked')).map(i => i.value);
Â  Â  if (checks.length === 0) {
Â  Â  Â  alert("Por favor, seleccione al menos una opciÃ³n.");
Â  Â  Â  btnEnviar.disabled = false;
Â  Â  Â  return;
Â  Â  }
Â  Â  esCorrecto = reto.correctas.every(c => checks.includes(c)) && checks.every(s => reto.correctas.includes(s));
Â  } else if (reto.tipo === "texto") {
Â  Â  // Tu lÃ³gica actual siempre marca los retos de texto como correctos
Â  Â  esCorrecto = true; 
Â  }

Â  if (esCorrecto) {
Â  Â  retoDiv.classList.add("correct");
Â  Â  fuegosArtificiales(); // Activar fuegos para preguntas de opciÃ³n/texto
Â  Â  divRespuestaCorrecta.textContent = "Â¡Correcto!"; 
Â  Â  divRespuestaCorrecta.style.display = "block"; // Mostrar el mensaje
Â  Â  btnMostrarRespuesta.style.display = "inline-block";
Â  Â  setTimeout(() => {
Â  Â  Â  divRespuestaCorrecta.style.display = "none"; // Ocultar el mensaje despuÃ©s de un tiempo
Â  Â  Â  btnNext.style.display = "inline-block"; 
Â  Â  }, DURACION_TOTAL_MS); // Espera a que los fuegos terminen
Â  } else {
Â  Â  retoDiv.classList.add("incorrect");
Â  Â  vibrar(); // Vibrar al fallar en preguntas de opciÃ³n/texto
Â  Â  divRespuestaCorrecta.textContent = "Respuesta incorrecta. IntÃ©ntalo de nuevo.";
Â  Â  divRespuestaCorrecta.style.display = "block"; // Mostrar el mensaje
Â  Â  btnEnviar.disabled = false; 
Â  Â  setTimeout(() => {
Â  Â  Â  divRespuestaCorrecta.style.display = "none"; // Ocultar el mensaje despuÃ©s de un tiempo
Â  Â  }, 2000); // Ocultar mensaje de incorrecto despuÃ©s de 2 segundos
Â  }
}

/* Mostrar respuesta correcta (para retos de opciÃ³n/texto) */
btnMostrarRespuesta.addEventListener("click", () => {
Â  const reto = retos[indiceReto];
Â  if (reto.tipo === "opcion" || reto.tipo === "opcion-multiple") {
Â  Â  divRespuestaCorrecta.textContent = "Respuesta correcta: " + reto.correctas.join(", ");
Â  } else if (reto.tipo === "texto") {
Â  Â  divRespuestaCorrecta.textContent = "Respuesta correcta: " + reto.correctaTexto;
Â  } else {
Â  Â  divRespuestaCorrecta.textContent = "No hay respuesta correcta disponible.";
Â  }
Â  divRespuestaCorrecta.style.display = "block"; // Asegurar que se muestre
});

/* BotÃ³n siguiente (solo para retos de opciÃ³n/texto) */
btnNext.addEventListener("click", () => {
Â  indiceReto++;
Â  if (indiceReto >= retos.length) {
Â  Â  alert("Â¡Has terminado todos los retos!");
Â  Â  indiceReto = 0;Â 
Â  }
Â  mostrarReto();
});

/* BotÃ³n enviar (solo para retos de opciÃ³n/texto) */
btnEnviar.addEventListener("click", verificar);

/* Listener para mensajes del iframe del puzzle */
window.addEventListener("message", (event) => {
Â  // Opcional: Puedes aÃ±adir una verificaciÃ³n de origen si tus puzzles se alojan en un dominio diferente
Â  // if (event.origin !== "https://valenciavguides.github.io") return; 

Â  // Mensaje del puzzle para que la pÃ¡gina principal reaccione con el borde de Ã©xito
Â  if (event.data === "puzzle-state-completed") {
Â  Â  console.log('Mensaje recibido: Puzzle completado. Poniendo borde verde.');
Â  Â  retoDiv.classList.add("correct"); // Borde verde
Â  Â  retoDiv.classList.remove("incorrect"); // Asegurarse de quitar el borde rojo si estaba
    divRespuestaCorrecta.textContent = "ðŸŽ‰ Â¡Puzzle Resuelto con Ã‰xito!"; // Mensaje
    divRespuestaCorrecta.style.display = "block"; // Mostrar mensaje
    // El mensaje se ocultarÃ¡ cuando el puzzle envÃ­e 'advance-to-next'
Â  } 
Â  // Mensaje del puzzle para que la pÃ¡gina principal reaccione con el borde de fallo
Â  else if (event.data === "puzzle-state-timeout") {
Â  Â  console.log('Mensaje recibido: Tiempo del puzzle agotado. Poniendo borde rojo y vibrando.');
Â  Â  retoDiv.classList.add("incorrect"); // Borde rojo
Â  Â  retoDiv.classList.remove("correct"); // Asegurarse de quitar el borde verde si estaba
Â  Â  vibrar(); // VibraciÃ³n al agotar el tiempo
    divRespuestaCorrecta.textContent = "â° Tiempo agotado. Gracias por participar."; // Mensaje
    divRespuestaCorrecta.style.display = "block"; // Mostrar mensaje
    // El mensaje se ocultarÃ¡ cuando el puzzle envÃ­e 'advance-to-next'
Â  } 
Â  // Esta es la seÃ±al FINAL del puzzle para AVANZAR al siguiente reto
Â  else if (event.data === "advance-to-next") {
Â  Â  console.log('Mensaje recibido: Avance al siguiente reto solicitado por el puzzle.');
    divRespuestaCorrecta.style.display = "none"; // Ocultar mensaje al avanzar
Â  Â  indiceReto++; // Avanza al siguiente reto
Â  Â  if (indiceReto >= retos.length) {
Â  Â  Â  alert("Â¡Has terminado todos los retos de la Aventura 1!");
Â  Â  Â  indiceReto = 0; // Opcional: Reiniciar o redirigir al final de la aventura
Â  Â  }
Â  Â  mostrarReto(); // Carga y muestra el siguiente reto
Â  }
});


/* Mostrar primer reto al cargar */
mostrarReto();

</script>
</body>
</html>
