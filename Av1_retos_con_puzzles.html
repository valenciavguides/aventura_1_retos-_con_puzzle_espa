<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Retos Aventura 1</title>
<style>
Â  Â  body {
Â  Â  Â  Â  font-family: "Book Antiqua", Palatino, serif;
        /* ANTES: margin: 1em; */
Â  Â  Â  Â  margin: 0 1em 1em; /* MODIFICADO: Elimina el margen superior, mantiene los demÃ¡s */
Â  Â  Â  Â  background: #fff;
Â  Â  Â  Â  color: #222;
Â  Â  Â  Â  font-size: 16px; /* Asegura un tamaÃ±o base para 'em' */
Â  Â  }
Â  Â  h2 { /* Este es el tÃ­tulo visible en la pÃ¡gina */
Â  Â  Â  Â  margin-bottom: 0.8em;
        margin-top: 0; /* AÃ‘ADIDO: Asegura que no haya margen superior en el h2 */
Â  Â  }
Â  Â  h3 {
Â  Â  Â  Â  margin-bottom: 0.2em;
Â  Â  }
Â  Â  #reto {
Â  Â  Â  Â  border: 3px solid #ccc; /* Grosor de borde constante */
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  padding: 1em;
Â  Â  Â  Â  margin-bottom: 1em;
Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  min-height: 220px;
Â  Â  }
Â  Â  .respuesta {
Â  Â  Â  Â  margin: 0.4em 0;
Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  align-items: center;
Â  Â  }
Â  Â  .respuesta input[type="radio"] {
Â  Â  Â  Â  margin-right: 0.7em;
Â  Â  Â  Â  transform: scale(1.3);
Â  Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .respuesta input[type="checkbox"] {
Â  Â  Â  Â  margin-right: 0.7em;
Â  Â  Â  Â  transform: scale(1.3);
Â  Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .respuesta input[type="text"] {
Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  padding: 0.3em 0.5em;
Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  border: 1px solid #999;
Â  Â  }
Â  Â  /* Contenedor para los botones para que estÃ©n en la misma lÃ­nea */
Â  Â  #button-container {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  flex-wrap: wrap; /* Permite que los botones salten de lÃ­nea si no hay espacio */
Â  Â  Â  Â  gap: 1em; /* Espacio entre los botones */
Â  Â  Â  Â  margin-top: 1em;
Â  Â  Â  Â  justify-content: center; /* Centra los botones horizontalmente */
Â  Â  Â  Â  align-items: center; /* Alinea verticalmente los botones si tienen alturas diferentes */
Â  Â  }

Â  Â  button.btn, button#btnMostrarRespuesta, button#btnNextAfterReto {
Â  Â  Â  Â  padding: 0.6em 1.2em;
Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  border: none; /* Se quita el borde de 2px para mantener el estilo del primer cÃ³digo */
Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  background-color: #0077cc;
Â  Â  Â  Â  color: white;
Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  transition: background-color 0.3s ease; /* TransiciÃ³n para hover */
Â  Â  }
Â  Â  button.btn:hover, button#btnNextAfterReto:hover {
Â  Â  Â  Â  background-color: #005699; /* Oscurecer al pasar el ratÃ³n */
Â  Â  }
Â  Â  button.btn:disabled {
Â  Â  Â  Â  background-color: #999;
Â  Â  Â  Â  cursor: not-allowed;
Â  Â  }
Â  Â  #btnMostrarRespuesta {
Â  Â  Â  Â  background-color: #28a745; /* Color del primer cÃ³digo */
Â  Â  Â  Â  display: none; /* Por defecto oculto, su visibilidad se controla con JS */
Â  Â  }
Â  Â  #btnMostrarRespuesta:hover {
Â  Â  Â  Â  background-color: #1e7e34; /* Oscurecer al pasar el ratÃ³n */
Â  Â  }
Â  Â  #btnNextAfterReto {
Â  Â  Â  Â  background-color: #0077cc; /* Usa el color original del botÃ³n para ser coherente */
Â  Â  Â  Â  display: none; /* Por defecto oculto, su visibilidad se controla con JS */
Â  Â  }


Â  Â  #respuestaCorrectaTexto {
Â  Â  Â  Â  margin-top: 1em;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  /* Estilos modificados: Ya no es una ventana flotante */
Â  Â  Â  Â  /* position: absolute; */
Â  Â  Â  Â  /* top: 50%; */
Â  Â  Â  Â  /* left: 50%; */
Â  Â  Â  Â  /* transform: translate(-50%, -50%); */
Â  Â  Â  Â  width: 100%; /* Ocupa el ancho completo disponible */
Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.9); /* Mantiene el fondo blanco semi-transparente */
Â  Â  Â  Â  padding: 1em;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
Â  Â  Â  Â  font-size: 1.5em;
Â  Â  Â  Â  color: #222;
Â  Â  Â  Â  z-index: 20; /* Puede eliminarse si no hay superposiciones */
Â  Â  Â  Â  display: none; /* Inicialmente oculto */
Â  Â  Â  Â  box-sizing: border-box; /* Asegura que padding no aÃ±ada ancho extra */
Â  Â  }
Â  Â  #fuegos {
Â  Â  Â  Â  pointer-events: none;
Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  top: 0; left: 0; /* Cubrir toda la ventana */
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  display: none; /* Inicialmente oculto */
Â  Â  }

Â  Â  /* Border colors for correct/incorrect */
Â  Â  #reto.correct {
Â  Â  Â  Â  border-color: #28a745; /* Verde */
Â  Â  }
Â  Â  #reto.incorrect {
Â  Â  Â  Â  border-color: #c00; /* Rojo */
Â  Â  }

Â  Â  /* Estilos especÃ­ficos para el iframe del puzzle */
Â  Â  #puzzleIframe {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  height: calc(100vh - 150px); /* Ajusta la altura para que ocupe mÃ¡s espacio en mÃ³viles */
Â  Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  display: block;
Â  Â  Â  Â  margin: 1em auto;
Â  Â  }

Â  Â  /* Media Query para mÃ³viles en horizontal: oculta el h2 y ajusta el espacio */
Â  Â  @media (max-width: 800px) and (orientation: landscape) {
Â  Â  Â  Â  h2 {
Â  Â  Â  Â  Â  Â  display: none; /* Oculta el tÃ­tulo "Reto Valencia be Guides" */
Â  Â  Â  Â  }
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0.5em; /* Reduce los mÃ¡rgenes del body para ganar espacio */
Â  Â  Â  Â  }
Â  Â  Â  Â  #reto {
Â  Â  Â  Â  Â  Â  min-height: 180px; /* Ajusta la altura mÃ­nima del reto */
Â  Â  Â  Â  Â  Â  padding: 0.8em; /* Reduce el padding del reto */
Â  Â  Â  Â  }
Â  Â  Â  Â  button.btn, button#btnMostrarRespuesta, button#btnNextAfterReto {
Â  Â  Â  Â  Â  Â  font-size: 1em; /* Reduce el tamaÃ±o de fuente de los botones */
Â  Â  Â  Â  Â  Â  padding: 0.5em 1em; /* Reduce el padding de los botones */
Â  Â  Â  Â  }
Â  Â  Â  Â  .respuesta {
Â  Â  Â  Â  Â  Â  font-size: 1em; /* Reduce el tamaÃ±o de fuente de las opciones */
Â  Â  Â  Â  }
Â  Â  Â  Â  .respuesta input[type="radio"], .respuesta input[type="checkbox"] {
Â  Â  Â  Â  Â  Â  transform: scale(1.1); /* Reduce un poco el tamaÃ±o de los radios/checkboxes */
Â  Â  Â  Â  }
Â  Â  Â  Â  #puzzleIframe {
Â  Â  Â  Â  Â  Â  height: calc(100vh - 120px); /* Ajusta la altura del iframe en landscape para dejar espacio */
Â  Â  Â  Â  }
Â  Â  }

Â  Â  /* Media Query para pantallas mÃ¡s grandes o portrait */
Â  Â  @media (min-width: 801px) or (orientation: portrait) {
Â  Â  Â  Â  #puzzleIframe {
Â  Â  Â  Â  Â  Â  max-width: 800px; /* Limita el ancho en pantallas grandes */
Â  Â  Â  Â  Â  Â  height: 600px; /* Altura fija para pantallas mÃ¡s grandes */
Â  Â  Â  Â  }
Â  Â  }
</style>
</head>
<body>

<h2></h2>
<div id="reto" tabindex="0"></div>

<div id="button-container">
Â  Â  <button id="btnMostrarRespuesta">Â¿Respuesta Correcta?</button>
Â  Â  <button id="btnNextAfterReto">Continue su Aventura</button>
</div>
<div id="respuestaCorrectaTexto"></div>

<div id="fuegos"></div>

<script>
/* --- Datos retos --- */
const retos = [
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "1. Â¿CuÃ¡ntas Aventuras pueden hacerse con Valencia be Guides?",
Â  Â  Â  Â  opciones: ["4", "5", "6", "7"],
Â  Â  Â  Â  correctas: ["7"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "2. Â¿SabrÃ­a decirme cÃ³mo se llaman estas Torres?",
Â  Â  Â  Â  opciones: ["Torres de Quart", "Torres de Serranos", "Torre del Miguelete", "Torre de Santa catalina"],
Â  Â  Â  Â  correctas: ["Torres de Serranos"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "3. Â¿En la cumbre de las torres ondea la bandera de Valencia: sus colores se componen de rojo, amarillo yâ€¦ ?",
Â  Â  Â  Â  opciones: ["Violeta", "Verde", "Azul"],
Â  Â  Â  Â  correctas: ["Azul"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "texto",
Â  Â  Â  Â  pregunta: "4. Â¿SabrÃ­a decirme el nombre de la calle?",
Â  Â  Â  Â  correctaTexto: "Calle Muro de Santa Ana"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "5. Â¿QuÃ© porta San Lorenzo en la mano?",
Â  Â  Â  Â  opciones: ["Una Paloma", "Una cuchara", "Una parrilla"],
Â  Â  Â  Â  correctas: ["Una parrilla"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "6. Â¿Con quÃ© mano sujeta Neptuno la cornucopia?",
Â  Â  Â  Â  opciones: ["Izquierda", "Derecha"],
Â  Â  Â  Â  correctas: ["Derecha"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "texto",
Â  Â  Â  Â  pregunta: "7. Â¿CuÃ¡ntas figuras rodean la fuente?",
Â  Â  Â  Â  correctaTexto: "8"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "puzzle",
Â  Â  Â  Â  pregunta: "8. Plaza de la Virgen",
Â  Â  Â  Â  puzzleSrc: "P8_puzzle_plaza_virgen.html"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "9. Â¿QuÃ© figura esculpida puede verse en el marco del cuadro?",
Â  Â  Â  Â  opciones: ["Un DragÃ³n", "Un MurciÃ©lago", "Una Corona"],
Â  Â  Â  Â  correctas: ["Una Corona"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion-multiple",
Â  Â  Â  Â  pregunta: "10. Â¿QuÃ© puede verse dentro?",
Â  Â  Â  Â  opciones: ["Un Altar", "Una bandera", "Una espada"],
Â  Â  Â  Â  correctas: ["Un Altar", "Una bandera"],
Â  Â  Â  Â  multiple: true
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "texto",
Â  Â  Â  Â  pregunta: "11. Sobre Ã©sta hay una placa conmemorativa. Â¿En quÃ© aÃ±o fue expuesta dicha placa?",
Â  Â  Â  Â  correctaTexto: "1952"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "texto",
Â  Â  Â  Â  pregunta: "12. Â¿En quÃ© aÃ±o se edificÃ³ esta finca? Â¡Pista! Mire en la parte superior de la fachada.",
Â  Â  Â  Â  correctaTexto: "1906"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "13. Â¿QuÃ© puede verse dentro?",
Â  Â  Â  Â  opciones: ["Una Plaza de Toros", "Unos baÃ±os romanos", "Una estaciÃ³n de metro"],
Â  Â  Â  Â  correctas: ["Unos baÃ±os romanos"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "14. Â¿SabrÃ­a determinar quÃ© geometrÃ­a tiene?",
Â  Â  Â  Â  opciones: ["hexagonal", "Octogonal", "Cuadrangular"],
Â  Â  Â  Â  correctas: ["hexagonal"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "texto",
Â  Â  Â  Â  pregunta: "15. Â¿CuÃ¡ntos Arcos componen la puerta?",
Â  Â  Â  Â  correctaTexto: "6"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "16. Â¿Recuerda quÃ© animal corona el escudo municipal?",
Â  Â  Â  Â  opciones: ["Un DragÃ³n", "Un MurciÃ©lago", "Un Caballo"],
Â  Â  Â  Â  correctas: ["Un MurciÃ©lago"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "17. Â¡Preste atenciÃ³n a la fachada de la primera torre! Â¿QuÃ© Fruta CÃ­trica natural de Valencia decora la fachada?",
Â  Â  Â  Â  opciones: ["Limones", "Pomelos", "Naranjas"],
Â  Â  Â  Â  correctas: ["Naranjas"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "puzzle",
Â  Â  Â  Â  pregunta: "18. Plaza de Toros y EstaciÃ³n del Norte",
Â  Â  Â  Â  puzzleSrc: "P18_puzzle_plaza_de_Toros_y_estacion_norte.html"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "texto",
Â  Â  Â  Â  pregunta: "19. Â¿SabrÃ­a decirme quÃ© comercio alberga dicho edificio?",
Â  Â  Â  Â  correctaTexto: "?"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion-multiple",
Â  Â  Â  Â  pregunta: "20. Sobre la entrada principal, en un arco de medio punto, figuras alegÃ³ricas representan a los cinco continentes. Â¿QuÃ© porta la figura central?",
Â  Â  Â  Â  opciones: ["Una Corona", "Una Espada", "Una Antorcha"],
Â  Â  Â  Â  correctas: ["Una Corona", "Una Espada"],
Â  Â  Â  Â  multiple: true
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "21. Â¿QuÃ© porta la figura en la mano?",
Â  Â  Â  Â  opciones: ["Una balanza", "Un libro", "Una pluma"],
Â  Â  Â  Â  correctas: ["Una balanza"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "texto",
Â  Â  Â  Â  pregunta: "22. Â¿Cuantas plantas tiene el edificio?",
Â  Â  Â  Â  correctaTexto: "10"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "23. Busque la vidriera con los colores de la SeÃ±era valenciana en la fachada del edificio. Â¿SabrÃ­a determinar quÃ© forma tiene?",
Â  Â  Â  Â  opciones: ["Cuadrangular", "Redonda", "Triangular"],
Â  Â  Â  Â  correctas: ["Redonda"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion-multiple",
Â  Â  Â  Â  pregunta: "24. Â¿QuÃ© sostiene la virgen en su mano?",
Â  Â  Â  Â  opciones: ["Un Rosario", "Un niÃ±o", "Una corona"],
Â  Â  Â  Â  correctas: ["Un Rosario", "Un niÃ±o"],
Â  Â  Â  Â  multiple: true
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "25. Â¿QuÃ© le entrega el Ã¡ngel al niÃ±o?",
Â  Â  Â  Â  opciones: ["Una paloma", "Un orbe", "Alimentos"],
Â  Â  Â  Â  correctas: ["Un orbe"],
Â  Â  Â  Â  multiple: false
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "puzzle",
Â  Â  Â  Â  pregunta: "26. Lonja de la Seda",
Â  Â  Â  Â  puzzleSrc: "P26_puzzle_lonja.html"
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion-multiple",
Â  Â  Â  Â  pregunta: "27. El barquero que rema a contracorriente.",
Â  Â  Â  Â  opciones: ["Un hombre con rostro triste manejando un pequeÃ±o bote de madera escapa a contracorriente de un monstruo."],
Â  Â  Â  Â  correctas: ["Un hombre con rostro triste manejando un pequeÃ±o bote de madera escapa a contracorriente de un monstruo."],
Â  Â  Â  Â  multiple: true
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion-multiple",
Â  Â  Â  Â  pregunta: "28. Un Ã¡rbol muerto: sÃ­mbolo del Pecado, se ve entre las dos hojas de la puerta y cumple la funciÃ³n de parteluz.",
Â  Â  Â  Â  opciones: ["Observe en la copa del Ã¡rbol como 4 hombres desnudos se azotan entre si."],
Â  Â  Â  Â  correctas: ["Observe en la copa del Ã¡rbol como 4 hombres desnudos se azotan entre si."],
Â  Â  Â  Â  multiple: true
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion-multiple",
Â  Â  Â  Â  pregunta: "29. A la derecha, un Ã¡ngel que muestra su pene y...",
Â  Â  Â  Â  opciones: ["se dispone a introducirlo en un jarrÃ³n que sostiene con la otra mano. Algo extraÃ±o e inusual Â¿no le parece?"],
Â  Â  Â  Â  correctas: ["se dispone a introducirlo en un jarrÃ³n que sostiene con la otra mano. Algo extraÃ±o e inusual Â¿no le parece?"],
Â  Â  Â  Â  multiple: true
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion-multiple",
Â  Â  Â  Â  pregunta: "30. En el centro El barbudo y el leÃ³n:",
Â  Â  Â  Â  opciones: ["Original y contradictoria escena en la cual el manso es precisamente el leÃ³n y no el anciano barbudo."],
Â  Â  Â  Â  correctas: ["Original y contradictoria escena en la cual el manso es precisamente el leÃ³n y no el anciano barbudo."],
Â  Â  Â  Â  multiple: true
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion-multiple",
Â  Â  Â  Â  pregunta: "31. Â¡AquÃ­ va un reto extra! Â¡Busque al fornicador de la lonja!",
Â  Â  Â  Â  opciones: ["En una de sus ventanas, hallarÃ¡ a un hombre tallado, no se le advierte su cabeza, pero sÃ­ sus genitales, Y muy claramente."],
Â  Â  Â  Â  correctas: ["En una de sus ventanas, hallarÃ¡ a un hombre tallado, no se le advierte su cabeza, pero sÃ­ sus genitales, Y muy claramente."],
Â  Â  Â  Â  multiple: true
Â  Â  },
Â  Â  {
Â  Â  Â  Â  tipo: "opcion",
Â  Â  Â  Â  pregunta: "32. Â¿QuÃ© sostiene el niÃ±o en sus manos?",
Â  Â  Â  Â  opciones: ["Una paloma", "Una Concha", "Alimentos"],
Â  Â  Â  Â  correctas: ["Una Concha"],
Â  Â  Â  Â  multiple: false
Â  Â  }
];

/* Variables para control */
let indiceReto = 0;
const retoDiv = document.getElementById("reto");
const btnEnviar = document.createElement("button");
btnEnviar.textContent = "Enviar";
btnEnviar.className = "btn";

const btnMostrarRespuesta = document.getElementById("btnMostrarRespuesta");
const divRespuestaCorrecta = document.getElementById("respuestaCorrectaTexto");
const btnNext = document.getElementById("btnNextAfterReto");
const fuegosDiv = document.getElementById("fuegos");

// DuraciÃ³n de la animaciÃ³n de fuegos artificiales (solo para retos de opciÃ³n/texto)
const DURACION_TOTAL_MS = 3000;

/* FunciÃ³n para limpiar el reto y mostrar uno nuevo */
function mostrarReto() {
Â  Â  // Limpiamos y ocultamos elementos visuales
Â  Â  btnNext.style.display = "none";
Â  Â  btnMostrarRespuesta.style.display = "none";
Â  Â  divRespuestaCorrecta.style.display = "none"; // Ocultar el mensaje de respuesta
Â  Â  divRespuestaCorrecta.textContent = "";
Â  Â  retoDiv.classList.remove("correct", "incorrect");
Â  Â  fuegosDiv.innerHTML = "";
Â  Â  fuegosDiv.style.display = "none"; // Asegura que los fuegos de la pÃ¡gina principal estÃ©n ocultos

Â  Â  const reto = retos[indiceReto];
Â  Â  retoDiv.innerHTML = "";
Â  Â  retoDiv.setAttribute("tabindex", "0");

Â  Â  let preguntaElem = document.createElement("h3");
Â  Â  preguntaElem.textContent = `${reto.pregunta}`;
Â  Â  retoDiv.appendChild(preguntaElem);

Â  Â  if (reto.tipo === "opcion" || reto.tipo === "opcion-multiple") {
Â  Â  Â  Â  const inputType = reto.multiple ? "checkbox" : "radio";
Â  Â  Â  Â  reto.opciones.forEach((opcion, i) => {
Â  Â  Â  Â  Â  Â  const divOpcion = document.createElement("div");
Â  Â  Â  Â  Â  Â  divOpcion.className = "respuesta";
Â  Â  Â  Â  Â  Â  const input = document.createElement("input");
Â  Â  Â  Â  Â  Â  input.type = inputType;
Â  Â  Â  Â  Â  Â  input.name = "op";
Â  Â  Â  Â  Â  Â  input.value = opcion;
Â  Â  Â  Â  Â  Â  input.id = "opcion" + i;
Â  Â  Â  Â  Â  Â  divOpcion.appendChild(input);

Â  Â  Â  Â  Â  Â  const label = document.createElement("label");
Â  Â  Â  Â  Â  Â  label.htmlFor = input.id;
Â  Â  Â  Â  Â  Â  label.textContent = opcion;
Â  Â  Â  Â  Â  Â  divOpcion.appendChild(label);
Â  Â  Â  Â  Â  Â  retoDiv.appendChild(divOpcion);
Â  Â  Â  Â  });
Â  Â  Â  Â  retoDiv.appendChild(btnEnviar);
Â  Â  Â  Â  btnEnviar.style.display = "inline-block";
Â  Â  Â  Â  btnEnviar.disabled = false;
Â  Â  } else if (reto.tipo === "texto") {
Â  Â  Â  Â  const inputTexto = document.createElement("input");
Â  Â  Â  Â  inputTexto.type = "text";
Â  Â  Â  Â  inputTexto.id = "respuestaTexto";
Â  Â  Â  Â  inputTexto.autocomplete = "off";
Â  Â  Â  Â  inputTexto.spellcheck = false;
Â  Â  Â  Â  inputTexto.setAttribute("inputmode", "text");
Â  Â  Â  Â  inputTexto.style.fontSize = "1.2em";
Â  Â  Â  Â  inputTexto.style.width = "100%";
Â  Â  Â  Â  inputTexto.placeholder = "Escriba su respuesta aquÃ­...";
Â  Â  Â  Â  retoDiv.appendChild(inputTexto);
Â  Â  Â  Â  retoDiv.appendChild(btnEnviar);
Â  Â  Â  Â  btnEnviar.style.display = "inline-block";
Â  Â  Â  Â  btnEnviar.disabled = false;
Â  Â  Â  Â  setTimeout(() => inputTexto.focus(), 200);
Â  Â  } else if (reto.tipo === "puzzle") {
Â  Â  Â  Â  const puzzleIframe = document.createElement("iframe");
Â  Â  Â  Â  puzzleIframe.id = "puzzleIframe";
Â  Â  Â  Â  puzzleIframe.src = reto.puzzleSrc;
Â  Â  Â  Â  puzzleIframe.frameBorder = "0";
Â  Â  Â  Â  puzzleIframe.allowFullscreen = true;
Â  Â  Â  Â  retoDiv.appendChild(puzzleIframe);

Â  Â  Â  Â  // Ocultamos btnEnviar, btnMostrarRespuesta y btnNext para los puzzles
Â  Â  Â  Â  // El avance lo gestiona el puzzle directamente al hacer clic en su botÃ³n "Continuar"
Â  Â  Â  Â  btnEnviar.style.display = "none";
Â  Â  Â  Â  btnMostrarRespuesta.style.display = "none";
Â  Â  Â  Â  btnNext.style.display = "none";
Â  Â  }
}

/* AnimaciÃ³n de fuegos artificiales valencianos (Solo para retos de opciÃ³n/texto, NO para puzzles) */
function fuegosArtificiales() {
Â  Â  const NUM_CHISPAS_POR_FUEGO = 30;
Â  Â  const NUM_EXPLOSIONES = 15;

Â  Â  fuegosDiv.innerHTML = "";
Â  Â  fuegosDiv.style.display = "block"; // Mostrar el contenedor de fuegos

Â  Â  for (let e = 0; e < NUM_EXPLOSIONES; e++) {
Â  Â  Â  Â  const delayExplosion = (DURACION_TOTAL_MS / NUM_EXPLOSIONES) * e;

Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  const startX = Math.random() * fuegosDiv.offsetWidth;
Â  Â  Â  Â  Â  Â  const startY = Math.random() * fuegosDiv.offsetHeight;

Â  Â  Â  Â  Â  Â  for (let i = 0; i < NUM_CHISPAS_POR_FUEGO; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  let chispa = document.createElement("div");
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.position = "absolute";
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.borderRadius = "50%";
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.width = "12px";
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.height = "12px";
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.background = `hsl(${Math.random() * 360}, 100%, 70%)`;
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.opacity = "1";
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.left = `${startX}px`;
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.top = `${startY}px`;
Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.zIndex = "10";

Â  Â  Â  Â  Â  Â  Â  Â  fuegosDiv.appendChild(chispa);

Â  Â  Â  Â  Â  Â  Â  Â  const angle = Math.random() * Math.PI * 2;
Â  Â  Â  Â  Â  Â  Â  Â  const distance = Math.random() * 80 + 40;
Â  Â  Â  Â  Â  Â  Â  Â  const endX = startX + distance * Math.cos(angle);
Â  Â  Â  Â  Â  Â  Â  Â  const endY = startY + distance * Math.sin(angle);

Â  Â  Â  Â  Â  Â  Â  Â  const chispaDuration = DURACION_TOTAL_MS / NUM_EXPLOSIONES * 1.5;

Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.transition = `all ${chispaDuration}ms ease-out`;
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.left = `${endX}px`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.top = `${endY}px`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.opacity = "0";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chispa.style.transform = "scale(0.5)";
Â  Â  Â  Â  Â  Â  Â  Â  }, 10);

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chispa.parentNode) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chispa.parentNode.removeChild(chispa);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }, delayExplosion + chispaDuration + 50);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, delayExplosion);
Â  Â  }
Â  Â  // Ocultar el contenedor de fuegos despuÃ©s de que terminen las animaciones
Â  Â  setTimeout(() => {
Â  Â  Â  Â  fuegosDiv.style.display = "none";
Â  Â  }, DURACION_TOTAL_MS + 100);
}


/* FunciÃ³n para vibrar */
function vibrar() {
Â  Â  if (navigator.vibrate) navigator.vibrate(300);
}

/* FunciÃ³n para verificar la respuesta (para retos de opciÃ³n/texto) */
function verificar() {
Â  Â  const reto = retos[indiceReto];
Â  Â  btnEnviar.disabled = true;
Â  Â  divRespuestaCorrecta.style.display = "none"; // Ocultar antes de mostrar nuevo mensaje
Â  Â  divRespuestaCorrecta.textContent = "";
Â  Â  retoDiv.classList.remove("correct", "incorrect");
Â  Â  fuegosDiv.innerHTML = "";
Â  Â  fuegosDiv.style.display = "none";

Â  Â  btnNext.style.display = "none";

Â  Â  let esCorrecto = false;

Â  Â  if (reto.tipo === "opcion") {
Â  Â  Â  Â  const seleccion = document.querySelector('input[name="op"]:checked');
Â  Â  Â  Â  if (!seleccion) {
Â  Â  Â  Â  Â  Â  alert("Por favor, seleccione una opciÃ³n.");
Â  Â  Â  Â  Â  Â  btnEnviar.disabled = false;
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  esCorrecto = reto.correctas.includes(seleccion.value);
Â  Â  } else if (reto.tipo === "opcion-multiple") {
Â  Â  Â  Â  const checks = Array.from(document.querySelectorAll('input[name="op"]:checked')).map(i => i.value);
Â  Â  Â  Â  if (checks.length === 0) {
Â  Â  Â  Â  Â  Â  alert("Por favor, seleccione al menos una opciÃ³n.");
Â  Â  Â  Â  Â  Â  btnEnviar.disabled = false;
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  esCorrecto = reto.correctas.every(c => checks.includes(c)) && checks.every(s => reto.correctas.includes(s));
Â  Â  } else if (reto.tipo === "texto") {
Â  Â  Â  Â  // Para retos de texto, la lÃ³gica actual simplemente los marca como correctos.
Â  Â  Â  Â  // Si necesitas verificaciÃ³n de texto, se debe aÃ±adir aquÃ­.
Â  Â  Â  Â  esCorrecto = true; // Si necesitas verificar el texto, modifica esta lÃ­nea
Â  Â  }

Â  Â  if (esCorrecto) {
Â  Â  Â  Â  retoDiv.classList.add("correct");
Â  Â  Â  Â  fuegosArtificiales(); // Activar fuegos para preguntas de opciÃ³n/texto
Â  Â  Â  Â  btnMostrarRespuesta.style.display = "inline-block"; // Mostrar botÃ³n de respuesta
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  btnNext.style.display = "inline-block"; // Mostrar botÃ³n siguiente
Â  Â  Â  Â  }, DURACION_TOTAL_MS); // Espera a que los fuegos terminen
Â  Â  } else {
Â  Â  Â  Â  retoDiv.classList.add("incorrect");
Â  Â  Â  Â  vibrar(); // Vibrar al fallar en preguntas de opciÃ³n/texto
Â  Â  Â  Â  btnEnviar.disabled = false;
Â  Â  Â  Â  btnMostrarRespuesta.style.display = "inline-block"; // Mostrar botÃ³n de respuesta
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  // No ocultar el mensaje de respuesta incorrecta si lo volvemos a mostrar con el botÃ³n.
Â  Â  Â  Â  Â  Â  // La visibilidad se controla al inicio de `mostrarReto` y `verificar`.
Â  Â  Â  Â  }, 2000); // Ocultar mensaje de incorrecto despuÃ©s de 2 segundos (ya no se muestra automÃ¡ticamente)
Â  Â  }
}

/* Mostrar respuesta correcta (para retos de opciÃ³n/texto) */
btnMostrarRespuesta.addEventListener("click", () => {
Â  Â  const reto = retos[indiceReto];
Â  Â  if (reto.tipo === "opcion" || reto.tipo === "opcion-multiple") {
Â  Â  Â  Â  divRespuestaCorrecta.textContent = "Respuesta correcta: " + reto.correctas.join(", ");
Â  Â  } else if (reto.tipo === "texto") {
Â  Â  Â  Â  divRespuestaCorrecta.textContent = "Respuesta correcta: " + reto.correctaTexto;
Â  Â  } else {
Â  Â  Â  Â  divRespuestaCorrecta.textContent = "No hay respuesta correcta disponible para este tipo de reto.";
Â  Â  }
Â  Â  divRespuestaCorrecta.style.display = "block"; // Asegurar que se muestre
});

/* BotÃ³n siguiente (solo para retos de opciÃ³n/texto) */
btnNext.addEventListener("click", () => {
Â  Â  indiceReto++;
Â  Â  if (indiceReto >= retos.length) {
Â  Â  Â  Â  alert("Â¡Has terminado todos los retos de la Aventura 1!");
Â  Â  Â  Â  indiceReto = 0; // Opcional: Reiniciar o redirigir al final de la aventura
Â  Â  }
Â  Â  mostrarReto();
});

/* BotÃ³n enviar (solo para retos de opciÃ³n/texto) */
btnEnviar.addEventListener("click", verificar);

/* Listener para mensajes del iframe del puzzle */
window.addEventListener("message", (event) => {
Â  Â  // Opcional: Puedes aÃ±adir una verificaciÃ³n de origen si tus puzzles se alojan en un dominio diferente
Â  Â  // if (event.origin !== "https://valenciavguides.github.io") return;

Â  Â  // Mensaje del puzzle para que la pÃ¡gina principal reaccione con el borde de Ã©xito
Â  Â  if (event.data === "puzzle-state-completed") {
Â  Â  Â  Â  console.log('Mensaje recibido: Puzzle completado. Poniendo borde verde.');
Â  Â  Â  Â  retoDiv.classList.add("correct"); // Borde verde
Â  Â  Â  Â  retoDiv.classList.remove("incorrect"); // Asegurarse de quitar el borde rojo si estaba
Â  Â  Â  Â  // divRespuestaCorrecta.textContent = "ðŸŽ‰ Â¡Puzzle Resuelto con Ã‰xito!"; // Ya no se muestra automÃ¡ticamente
Â  Â  Â  Â  // divRespuestaCorrecta.style.display = "block"; // Ya no se muestra automÃ¡ticamente
Â  Â  }
Â  Â  // Mensaje del puzzle para que la pÃ¡gina principal reaccione con el borde de fallo por tiempo
Â  Â  else if (event.data === "puzzle-state-timeout") {
Â  Â  Â  Â  console.log('Mensaje recibido: Tiempo del puzzle agotado. Poniendo borde rojo y vibrando.');
Â  Â  Â  Â  retoDiv.classList.add("incorrect"); // Borde rojo
Â  Â  Â  Â  retoDiv.classList.remove("correct"); // Asegurarse de quitar el borde verde si estaba
Â  Â  Â  Â  vibrar(); // VibraciÃ³n al agotar el tiempo
Â  Â  Â  Â  // divRespuestaCorrecta.textContent = "â° Tiempo agotado. Gracias por participar."; // Ya no se muestra automÃ¡ticamente
Â  Â  Â  Â  // divRespuestaCorrecta.style.display = "block"; // Ya no se muestra automÃ¡ticamente
Â  Â  }
Â  Â  // Esta es la seÃ±al FINAL del puzzle para AVANZAR al siguiente reto
Â  Â  // Se activa cuando el usuario hace clic en el botÃ³n "Continuar" dentro del puzzle.
Â  Â  else if (event.data === "advance-to-next") {
Â  Â  Â  Â  console.log('Mensaje recibido: Avance al siguiente reto solicitado por el puzzle.');
Â  Â  Â  Â  divRespuestaCorrecta.style.display = "none"; // Ocultar mensaje al avanzar
Â  Â  Â  Â  indiceReto++; // Avanza al siguiente reto
Â  Â  Â  Â  if (indiceReto >= retos.length) {
Â  Â  Â  Â  Â  Â  alert("Â¡Has terminado todos los retos de la Aventura 1!");
Â  Â  Â  Â  Â  Â  indiceReto = 0; // Opcional: Reiniciar o redirigir al final de la aventura
Â  Â  Â  Â  }
Â  Â  Â  Â  mostrarReto(); // Carga y muestra el siguiente reto
Â  Â  }
});

/* Mostrar primer reto al cargar */
mostrarReto();

</script>
</body>
</html>
